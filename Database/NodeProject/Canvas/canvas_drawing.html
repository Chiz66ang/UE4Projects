<!DOCTYPE html>
<html lang='utf8'>
    <head>
        <title>Canvas Drawing</title>
        <style>
            canvas { border:1px solid black; background-color: #FFFFFF;}
        </style>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script>
            $().ready(function(){
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d"); //붓과 같은 객체. 그리는 준비를 해준다.
                ctx.strokeRect(0,0,100,100);
                let h=canvas.clientHeight;
                let w=canvas.clientWidth;
                
                canvas.addEventListener('mousedown', function(e){
                    let clickX= e.pageX-canvas.offsetLeft;
                    let clickY= e.pageY-canvas.offsetTop;
                    
                    redBall.dir = new Vector2D(clickX-redBall.x, clickY-redBall.y).normalize();
                    $('gamestart').trigger('click');
                });
                window.addEventListener('keydown', function(e){
                    console.log('이벤트 종류 = %s, 키=%d', e.type, e.keyCode);
                    if(e.keyCode == 13){
                        $('#gamestart').trigger('click');
                    }
                    if(e.keyCode == 27){
                        $('#gamepause').trigger('click');
                    }
                    else return;
                });

                window.addEventListener('keyup', function(e){
                    console.log('이벤트 종류 = %s, 키=%d', e.type, e.keyCode);
                });

                //ctx.fillStyle='#FF0000';
                //ctx.strokeStyle='#000000';
                //ctx.fillRect(w/2-50,h/2-50,100,100);
                //ctx.strokeRect(w/2-50,h/2-50,100,100); //strokeRect 테두리를 가진 사각형. 채워야 한다면 fillRect
                //ctx.beginPath();
                //ctx.fillStyle="#FF0000";
                //ctx.arc(w/2, h/2, 50, 0,2*Math.PI, true);
                //ctx.fill();
                //ctx.closePath();
                $('#gamepause').click(function(){
                    window.clearInterval(timer);
                })

                $('#gamestart').click(function(){
                    let curMS = 0;
                    let preMS = 0;
                    let deltaSeconds = 0;
                    let redBall = new Ball(50,100,50,'red',canvas, ctx);

                    timer = window.setInterval(function(){
                    ctx.clearRect(0,0,w,h);
                    curMS = Date.now();
                    if(preMS==0) preMS=curMS;
                    else{
                        deltaSeconds = (curMS-preMS)/1000.0;
                        redBall.move(deltaSeconds);
                        }   
                    preMS = curMS;
                    },20); //밀리초 기준
                })
            });

            //공의 위치, 색상, 속도
            class Ball{
                constructor(x,y,r,color,canvas,ctx){
                    this.x=x;
                    this.y=y;
                    this.r=r;
                    this.color=color;
                    this.cw=canvas.clientWidth;
                    this.ch=canvas.clientHeight;
                    this.ctx=ctx;

                    //let dx = Math.random();
                    //let dy = Math.random();
                    //dx *=Math.random()>0.5 ? 1 : -1;
                    //dy *=Math.random()>0.5 ? 1 : -1;

                    //this.dir = new Vector2D(dx,dy).normalize();
                }
                move(deltaSeconds){
                    //this.x += deltaSeconds*100;
                    this.dir.multiply(deltaSeconds*100);
                    this.x += this.dir.x*3;
                    this.y += this.dir.y*3;
                    this.draw();
                }
                draw(){
                    this.ctx.beginPath();
                    this.ctx.fillStyle=this.color;
                    this.ctx.arc(this.x, this.y, this.r, 0,2*Math.PI, true);
                    this.ctx.fill();
                    this.ctx.closePath();
                }
            }

            class Vector2D{
                constructor(x,y){
                    this.x=x;
                    this.y=y;
                }

                length(){
                    return Math.sqrt(this.x*this.x + this.y*this.y);
                }

                normalize(){
                    let len = this.length();
                    return new Vector2D(this.x/len, this.y/len);
                }

                multiply(len){
                    return new Vector2D(this.x*len, this.y*len);
                }
            }

        </script>
    </head>

    <body>
        <h3>Canvas Drawing Example</h3>
        <div></div><button id='gamestart' type='button'>GAMESTART</button></div>
        <div><button id='gamepause' type='button'>GAMEPAUSE</button></div>
        <canvas id='myCanvas' width='800' height='600'></canvas>
    </body>
</html>